"use strict";

var _Object$defineProperty = require("@babel/runtime-corejs2/core-js/object/define-property");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.generateHeaderMenuItemsGroups = generateHeaderMenuItemsGroups;

var _jsUtils = require("@gooddata/js-utils");

// (C) 2007-2020 GoodData Corporation
function generateHeaderMenuItemsGroups(targetApp, featureFlags, workspacePermissions, hasAnalyticalDashboards, // bootstrapResource.current.analyticalDashboards > 0
workspaceId, // parsed from bootstrapResource.current.project.links.self
dashboardId, // bootstrapResource.profileSetting.projectSettings.{workspaceUri}.dashboard
tabId) {
  if (!workspaceId) {
    return [];
  }

  var enableAnalyticalDashboards = featureFlags.enableAnalyticalDashboards,
      analyticalDesigner = featureFlags.analyticalDesigner,
      enableCsvUploader = featureFlags.enableCsvUploader;
  var canCreateAnalyticalDashboard = workspacePermissions.canCreateAnalyticalDashboard,
      canCreateVisualization = workspacePermissions.canCreateVisualization,
      canUploadNonProductionCSV = workspacePermissions.canUploadNonProductionCSV,
      canAccessWorkbench = workspacePermissions.canAccessWorkbench,
      canManageReport = workspacePermissions.canManageReport,
      canManageMetric = workspacePermissions.canManageMetric;
  var menuItemsGroups = [];

  var shouldHidePixelPerfectExperience = _jsUtils.featureFlagsUtils.shouldHidePPExperience(featureFlags); // PIXEL PERFECT MENU ITEMS


  if (!shouldHidePixelPerfectExperience) {
    var pixelPerfectItemsGroup = [];
    var dashboardIdAndTabId = dashboardId && tabId ? "".concat(dashboardId, "|").concat(tabId) : "";
    var pixelPerfectDashboardsItem = {
      key: "gs.header.dashboards",
      className: "s-menu-dashboards",
      href: "/#s=/gdc/projects/".concat(workspaceId, "|projectDashboardPage|").concat(dashboardIdAndTabId)
    };
    var pixelPerfectReportsItem = {
      key: "gs.header.reports",
      className: "s-menu-reports",
      href: "/#s=/gdc/projects/".concat(workspaceId, "|domainPage|all-reports")
    };
    var showPixelPerfectDashboardsItem = canAccessWorkbench === true;
    var showPixelPerfectReportsItem = canManageReport === true;

    if (showPixelPerfectDashboardsItem) {
      pixelPerfectItemsGroup.push(pixelPerfectDashboardsItem);
    }

    if (showPixelPerfectReportsItem) {
      pixelPerfectItemsGroup.push(pixelPerfectReportsItem);
    }

    menuItemsGroups.push(pixelPerfectItemsGroup);
  } // INSIGHTS MENU ITEMS


  var insightItemsGroup = [];
  var kpiDashboardsItem = {
    key: "gs.header.kpis",
    className: "s-menu-kpis",
    href: "/dashboards/#/project/".concat(workspaceId)
  };
  var analyticalDesignerItem = {
    key: "gs.header.analyze",
    className: "s-menu-analyze",
    href: "/analyze/#/".concat(workspaceId, "/reportId/edit")
  };
  var loadCsvItem = {
    key: "gs.header.load",
    className: "s-menu-load",
    href: "/data/#/projects/".concat(workspaceId, "/datasets")
  };
  var showKpiDashboardsItem = targetApp === "kpiDashboards" || hasAnalyticalDashboards || canCreateAnalyticalDashboard === true && enableAnalyticalDashboards;
  var showAnalyticalDesignerItem = targetApp === "analyticalDesigner" || canCreateVisualization === true && analyticalDesigner;
  var showLoadCsvItem = canUploadNonProductionCSV === true && enableCsvUploader;

  if (showKpiDashboardsItem) {
    insightItemsGroup.push(kpiDashboardsItem);
  }

  if (showAnalyticalDesignerItem) {
    insightItemsGroup.push(analyticalDesignerItem);
  }

  if (showLoadCsvItem) {
    insightItemsGroup.push(loadCsvItem);
  }

  menuItemsGroups.push(insightItemsGroup); // MANAGE ITEMS

  var manageItemsGroup = [];
  var manageItem = {
    key: "gs.header.manage",
    className: "s-menu-manage",
    href: "/#s=/gdc/projects/".concat(workspaceId, "|dataPage|")
  };
  var showManageItem = canManageMetric === true;

  if (showManageItem) {
    manageItemsGroup.push(manageItem);
  }

  menuItemsGroups.push(manageItemsGroup);
  return menuItemsGroups.filter(function (itemsGroup) {
    return itemsGroup.length > 0;
  });
}